#!/bin/bash -eu
export SHELLOPTS
export GIT_DIR="${1:-}"

function error_exit() {
  echo "$1" >&2 && exit 1
}

test -z "$GIT_DIR" && error_exit "usage: gitopt /path/to/git/repo/.git"
export GIT_DIR=$(readlink -f $GIT_DIR)

test -d "$GIT_DIR" || error_exit "$GIT_DIR is not a directory"

echo "cleaning $GIT_DIR"

git gc --aggressive
git prune
git repack -a -d

test -d $GIT_DIR/hooks && find $GIT_DIR/hooks -name '*.sample' -delete
