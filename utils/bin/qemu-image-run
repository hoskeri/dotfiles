#!/bin/sh -eu

workdir=$HOME/.qemu-image-builder/vms
vm=$workdir/${1:-}
diskname=$vm/snapshot.qcow2
base=$vm/base.qcow2

test -z "${1:-}" && ( echo "no vm given!" && exit 1 )
test -d $vm || ( echo "$vm not found!" && exit 1 )
test -f $vm/vm.config || ( echo "$vm config not found!" && exit 1 )
test -f $diskname || qemu-img create -q -f qcow2 -b $base $diskname

exec qemu-system-x86_64 -readconfig $vm/vm.config
