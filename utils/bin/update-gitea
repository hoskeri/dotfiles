#!/bin/sh -eux

[ "$(id -u)" != "0" ] && ( echo "please run as root" && exit 1 )

DESTDIR=/home/git
GITEA_USER=git
GITEA_GROUP=git
tmpfile=$(mktemp $DESTDIR/giteaXXXXX)
chattr -i $DESTDIR/gitea
curl -s -k -o $tmpfile https://dl.gitea.io/gitea/master/gitea-master-linux-amd64
chmod +x $tmpfile

mv $tmpfile $DESTDIR/gitea
chown ${GITEA_USER}:${GITEA_GROUP} $DESTDIR/gitea
chattr +i $DESTDIR/gitea
