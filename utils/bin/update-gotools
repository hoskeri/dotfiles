#!/bin/bash
set -eu
. /etc/environment

export GOPATH=$HOME/.gotools-install
export GO_BIN=$GOPATH/bin
export PATH="$GO_BIN:$PATH:$HOME/bin"

go_get="go get -u -v "

mkdir -p "$GOPATH"

echo -e 'export GOPATH=$(pwd)\n' > "$GOPATH/.envrc"
echo -e '*\n!.envrc\n!.versions' > "$GOPATH/.gitignore"

$go_get github.com/nsf/gocode
$go_get github.com/rogpeppe/godef
$go_get github.com/lukehoban/go-outline
$go_get sourcegraph.com/sqs/goreturns
$go_get github.com/tpng/gopkgs
$go_get github.com/newhook/go-symbols
$go_get github.com/ddollar/forego
$go_get github.com/motemen/gore
$go_get github.com/github/hub
$go_get github.com/kardianos/govendor
$go_get github.com/hoskeri/liverebuild
$go_get github.com/jstemmer/gotags
$go_get github.com/klauspost/asmfmt
$go_get github.com/fatih/motion
$go_get github.com/zmb3/gogetdoc
$go_get github.com/josharian/impl
$go_get bitbucket.org/liamstask/goose/cmd/goose
$go_get github.com/golang/lint/golint
$go_get github.com/kisielk/errcheck
$go_get github.com/ericchiang/pup
$go_get github.com/fatih/gomodifytags
$go_get github.com/dominikh/go-tools/cmd/keyify
$go_get github.com/klauspost/asmfmt/cmd/asmfmt
$go_get github.com/davidrjenni/reftools/cmd/fillstruct
$go_get github.com/junegunn/fzf

$go_get github.com/alecthomas/gometalinter
gometalinter --install -u >/dev/null 2>/dev/null

$go_get github.com/samuel/go-thrift/generator
mv -f "$GO_BIN/generator" "$GO_BIN/gothrift-gen"

strip "$GO_BIN"/*

cd "$GOPATH"

test -d .git || git init -q .
find "$GOPATH/src" -type d -name '.git' -print0 |xargs --null -n1 git-repostat > "$GOPATH/.versions"

if git diff --quiet && git diff --cached --quiet
then
  git add .
  git commit -am "gotools update: $(date -Iseconds)"
fi

