#!/bin/bash
set -eux
. /etc/environment

export GOPATH=$HOME/.gotools-install
export GO_BIN=$GOPATH/bin
export PATH="$GO_BIN:$PATH:$HOME/bin"

mkdir -p "$GOPATH"

echo -e 'export GOPATH=$(pwd)' > "$GOPATH/.envrc"
echo -e '*\n!.envrc\n!.versions' > "$GOPATH/.gitignore"

cat <<- END |xargs go get -u -v
github.com/stamblerre/gocode
github.com/rogpeppe/godef
github.com/lukehoban/go-outline
sourcegraph.com/sqs/goreturns
github.com/tpng/gopkgs
github.com/newhook/go-symbols
github.com/ddollar/forego
github.com/motemen/gore
github.com/github/hub
github.com/jstemmer/gotags
github.com/fatih/motion
github.com/zmb3/gogetdoc
github.com/josharian/impl
golang.org/x/lint/golint
github.com/ericchiang/pup
github.com/fatih/gomodifytags
github.com/dominikh/go-tools/cmd/keyify
github.com/klauspost/asmfmt/cmd/asmfmt
github.com/davidrjenni/reftools/cmd/fillstruct
github.com/junegunn/fzf
github.com/hoskeri/liverebuild
github.com/alecthomas/gometalinter
END

ln -sf "${GO_BIN}/gocode" "${GO_BIN}/gocode-gomod"

gometalinter --install

strip "$GO_BIN"/*

cd "$GOPATH"

if test -d .git
then
  git init -q .
fi

find "$GOPATH/src" -type d -name '.git' -print0 |xargs --null -n1 git-repostat > "$GOPATH/.versions"

if [ "$(git diff)$(git diff --cached)" != "" ]
then
  git add .
  git commit -am "gotools update: $(date -Iseconds)"
fi

