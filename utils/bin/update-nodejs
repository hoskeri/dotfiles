#!/bin/bash
set -eu
baseurl="https://nodejs.org/dist/latest"
workdir=$HOME/.update-nodejs-cache
installdir=$HOME/.update-nodejs-cache/install

mkdir -p $workdir

curl -s -L -o $workdir/checksums "$baseurl/SHASUMS256.txt"
archive=$(grep 'linux-x64.tar.xz' $workdir/checksums|cut -d' ' -f3)

echo "installing $archive"
wget -q -c -O $workdir/$archive $baseurl/$archive

rm -rf $installdir
mkdir $installdir
tar -C $installdir -Jxf $workdir/$archive --strip-components=1

test -d $HOME/.nodejs && rm -rf $HOME/.nodejs

ln -s $installdir/bin/node $installdir/bin/nodejs
ln -sf $installdir $HOME/.nodejs
